<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HIIT Timer</title>
  <link href="https://fonts.googleapis.com/css?family=Rubik:300,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Archivo+Narrow&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Telex&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
  <body>
    <div class="wrapper">
      
        <div class="title">
          <h1></h1>
          <p></p>
        </div>
      
        <div class="exercises">
          <template id="exercise-action-template">
            <div class="action">
              <h2></h2>
              <span></span>
              <div class="view-details-button">
              </div>
              <div class="instruction">
                <img src="">
                <p></p>
              </div>
            </div>
          </template>
        </div>
      
      <footer>
        <span>Just a little HIIT timer</span>
        <span>Created by Nancy Huynh</span>
      </footer>
    
    </div>
    
    <script>
      const getWorkoutIdFromUrl = () => {
        const urlParams = new URLSearchParams(document.location.search);
        return urlParams.has('workout') ? urlParams.get('workout') : undefined;
      }
      
      // TO DO: get the workout from json based on workout id
      const sampleWorkout =
        {
          name: "Test Workout",
          description: "Just a test workout for testing the app",
          exercises: [{id: 1, action: "Bicep Curls", seconds: 20}, {action: "Rest", seconds: 20}, {id: 2, action: "Lateral Shoulder Raises", seconds: 20}]
        }
      
      const titleContainer = document.querySelector('.title');
      titleContainer.querySelector('h1').textContent = sampleWorkout.name;
      titleContainer.querySelector('p').textContent = sampleWorkout.description;
      
      const exercisesContainer = document.querySelector('.exercises');
      sampleWorkout.exercises.forEach((exercise, index) => {
        const template = document.querySelector('#exercise-action-template').content.cloneNode(true);
        template.querySelector('.action h2').textContent = exercise.action;
        template.querySelector('.action span').textContent = `${exercise.seconds} seconds`;
        template.querySelector('.view-details-button').setAttribute('id', index);
        template.querySelector('.view-details-button').dataset.action = exercise.id;
        template.querySelector('.instruction').dataset.instruction = index;
        if(!exercise.hasOwnProperty('id')){
          template.querySelector('.instruction').remove();
          template.querySelector('.view-details-button').remove();
        }
        exercisesContainer.insertBefore(template, document.querySelector('#exercise-action-template'));
      })
      
      const accordionHandler = async (e) => {
        if(e.target.matches('.view-details-button')) {
          e.preventDefault();
          const id = e.target.getAttribute('id');
          const actionId = e.target.dataset.action;
          
          const feed = await fetch('feeds/exercises.json');
          const json = await feed.json();
          const exercise = json[actionId] || {};
          
          const instructionDiv = document.querySelector(`[data-instruction='${id}']`);
          instructionDiv.querySelector('p').textContent = exercise.hasOwnProperty('instruction') ? 
            exercise.instruction : "";
          instructionDiv.querySelector('img').src = exercise.hasOwnProperty('image') ? 
            exercise.image : "";
          
          e.target.classList.toggle('active');
          instructionDiv.classList.toggle('active');
        } 
        else {
          return;
        }
      }
      document.addEventListener('click', accordionHandler);
    </script>
  </body>
</html>